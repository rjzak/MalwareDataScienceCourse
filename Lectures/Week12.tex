\documentclass{beamer}
\usepackage[T1]{fontenc}
\usepackage{graphicx}
\usepackage{listings} % Syntax highlighing
\usepackage{fancyvrb} % Inline verbatim
\usepackage{hyperref} % Hyperlinks
\hypersetup{pdfpagemode=FullScreen}
\usepackage{tikz}

\usetheme{Boadilla}
\title{PDF \& RTF Malware}
\author{UMBC Malware Data Science}
\date{Week 12: 20 April 2020}

\begin{document}

\begin{frame}{Recap}
    We've been looking at executable malware, specifically for Windows. Let's turn our attention on something a little easier, PDF \& RTF malware.
\end{frame}

\begin{frame}{PDF}
    \begin{columns}
        \column{0.85\textwidth}
            \begin{itemize}
                \item The Portable Document Format created by Adobe in 1993.
                \item Uses Javascript for interactive documents, such as form validation.
                \item Has Forms, which helps with office automation.
                \item Can contain embedded content, such as fonts, Adobe Flash, 3D content, video, etc.
                \item All of this can be exploited for malicious intent.
            \end{itemize}
        \column{0.15\textwidth}
            \includegraphics[scale=0.05]{Images/AdobePDF.png}
    \end{columns}
\end{frame}

\begin{frame}[fragile]{PDF Pages}
\begin{verbatim}
2 0 obj
<< /Type /Pages
     /Kids [ 4 0 R
             10 0 R
             24 0 R]
     /Count 3
>>
endobj

4 0 obj
<< /Type /Page
... Additional entries describing the attributes of this page
>>
endobj
\end{verbatim}
Pages don't have to be in the same order in which they appear.
\end{frame}

\begin{frame}[fragile]{PDF Object}
\begin{verbatim}
3 0 obj
  << /Type /Page
     /Parent 2 0 R
     /MediaBox [0 0 600 400]
     /Resources << >>
  >>
endobj
\end{verbatim}
Draw a rectangle, using resources described in \texttt{/Resources}.
\end{frame}

\begin{frame}[fragile]{PDF xref}
\begin{verbatim}
xref
0 4
00000000000 65535 f
00000000010 00000 n
00000000069 00000 n
00000000141 00000 n
trailer
  << /Root 1 0 R
     /Size 4
  >>
startxref
249
%%EOF
\end{verbatim}
PDF Table of Contents is at the end of the file.
\end{frame}

\begin{frame}{PDF Malware}
    \only<1>{
        PDF malware typically one of the following:
        \begin{itemize}
            \item Use Javascript to build large data inside a PDF structure, such that at runtime, a buffer overflow occurs and the renderer crashes.
            \item Use Javascript to cause Adobe Acrobat to interact with the host OS or other application in an undesired manner.
            \item Contains malicious content which causes the PDF renderer to crash.
            \item Contains malicious content which runs as intended, causing something else to crash or triggers an exploit elsewhere (font renderer, Flash player, etc).
            \item Contains PDF code which doesn't make sense, such as drawing a box with invalid parameters, causing Adobe Acrobat to crash.
        \end{itemize}
    }
    \only<2>{
        \begin{itemize}
            \item Often a malicious PDF contains a clean version of itself, so Adobe Acrobat may crash, then suddenly a clean version opens, and often the user doesn't notice, or assumes that things are okay.
            \item Not all PDF malware targets Adobe Acrobat. Windows' PDF renderers (in Windows 10 viewers, MS Internet Explorer), FoxIt PDF are some known other PDF exploit targets.
        \end{itemize}
    }
    \only<3>{
        Assumption: PDFs should never contain byte $n$-grams which are executable bytes, such byte sequences would likely be shellcode.
    }
\end{frame}

\begin{frame}[fragile]{RTF}
    \begin{itemize}
        \item The Rich Text Format was first developed by Microsoft in 1987.
        \item RTFs can contain embedded images, fonts, annotations, and Microsoft OLE (Object Linking and Embedding) objects -- so basically anything.
        \item Malicious RTF emails can affect MS Outlook, allowing compromise just by viewing an email.
    \end{itemize}
    
    Basic example:
    \begin{verbatim}
{\rtf1\ansi{\fonttbl\f0\fswiss Helvetica;}\f0\pard
 This is some {\b bold} text.\par
 }
    \end{verbatim}
    \footnotesize{Source: \url{https://en.wikipedia.org/wiki/Rich_Text_Format}}
\end{frame}

\begin{frame}{PDF Malware Detection Pitfalls}
    It's common for PDF malware detectors to assume that PDFs with Javascript are all bad, yet that's not the case. For example, a lot of government agencies use PDF forms and Javascript for input validation. Yet for our machine learning and data science perspective, a lot of Javascript PDFs are in the malware category. To help balance this, it's useful to try to add weird yet safe PDFs to the training collection.
\end{frame}

\begin{frame}{Lab 12}
    For this Lab, use the existing $n$-gram tools you've created so far to create a PDF malware detection model. No code changes should be required.
    \\ ~~ \\
    Optional: Identify domain-specific features for PDFs, measure their impact on the model you make.
\end{frame}

\end{document}